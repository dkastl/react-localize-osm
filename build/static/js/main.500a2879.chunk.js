(this["webpackJsonpreact-map"]=this["webpackJsonpreact-map"]||[]).push([[0],{103:function(e,t,n){},104:function(e,t,n){"use strict";n.r(t);var a=n(2),i=n(0),s=n.n(i),o=n(17),c=n.n(o),r=(n(76),n(19)),u=n(9),l=n(6),h=n(14),d=n(15),g=n(69),m=n(68),f=n(67),b=n(39),j=n(112),p=n(114),v=n(113),O=n(110),y=function(e){return[e.lat,e.lng]};function k(e){var t=e.onLoad,n=e.onMove,a=e.onClick,i=e.center,s=e.zoom,o=Object(O.a)(),c=o.getCenter();return c.lat===i[0]&&c.lng===i[1]||o.flyTo(i,s),Object(O.b)({move:function(){var e=o.getCenter();n({bbox:Object.values(o.getBounds()).map(y),center:y(e),zoom:o.getZoom()})},click:function(){a()}}),t({bbox:Object.values(o.getBounds()).map(y)}),null}var x=n(111),C=n(16),w=n.n(C),S=(n(77),n(78),n(79),n(80),function(e,t,n){return w.a.AwesomeMarkers.icon({icon:e,prefix:"fa",markerColor:t,className:"awesome-marker awesome-marker-"+n})}),L=function(e){var t=e.type,n=e.shape,a=e.color;return{icon:S(t,void 0===a?"blue":a,n),touched:S(t,"orange",n),focused:S(t,"red",n)}},I=L({type:"circle"}),T=[{cat:"tourism",tag:["hotel","hostel"],iconType:"hotel"},{cat:"place",tag:["city","town","neighborhood"],iconType:"city"},{cat:"place",tag:["village","hamlet"],iconType:"home"},{cat:"aeroway",iconType:"plane"},{cat:"shop",iconType:"store"},{cat:"historic",iconType:"monument"},{cat:"leisure",iconType:"futbol"},{cat:"tourism",iconType:"compass"},{cat:"highway",iconType:"road"},{cat:"building",iconType:"building"},{cat:"natural",iconType:"tree"},{cat:"waterway",iconType:"water"}].map((function(e){return Object(l.a)(Object(l.a)({},e),L({type:e.iconType}))})),z=function(e,t,n){return(T.find((function(t){return!t.tag&&e[t.cat]||e.tags[t.cat]&&-1!==e.tags[t.cat].indexOf(t.tag)}))||I)[n?"focused":t?"touched":"icon"]};function M(e){var t=e.item,n=e.touched,s=e.focused,o=e.position,c=e.onClick,r=Object(i.useRef)(null),u=Object(i.useMemo)((function(){return{click:c}}),[c]);return Object(a.jsx)(x.a,{position:o,icon:z(t,n,s),eventHandlers:u,ref:r})}var F=Object(l.a)(Object(l.a)({},{tileUrl:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),{},{minZoom:3,maxZoom:19}),U=function(e){return[(t=e.center||e).lat,t.lon];var t};var N=function(e){var t=e.center,n=e.zoom,i=e.items,s=e.touched,o=e.lang,c=void 0===o?"en":o,r=e.focused,u=e.handlers,l=u.onMove,h=u.onLoad,d=u.onClickItem,g=u.onClickMap,m=F.tileUrl;return F.addLang&&(m+="?lang="+c),Object(a.jsxs)(j.a,{center:t,zoom:n,scrollWheelZoom:!0,minZoom:F.minZoom,maxZoom:F.maxZoom,children:[Object(a.jsx)(p.a,{attribution:F.attribution,url:m,minZoom:F.minZoom,maxZoom:F.maxZoom}),Object(a.jsx)(k,{center:t,zoom:n,onMove:l,onLoad:h,onClick:g}),i.map((function(e){return Object(a.jsx)(M,{item:e,position:U(e),touched:-1!==s.indexOf(e.id),focused:r===e.id,onClick:function(){return d(e.id)}},e.id)})),Object(a.jsx)(v.a,{})]})};function A(){return Object(a.jsx)("div",{children:"Login to your OpenStreetMap account to start editing!"})}var E=n(32),P=n(38),_=n(31),B=n(18),Z=n(21);function R(e){var t=e.vkey,n=e.title,i=e.onChange,s=e.checked;return Object(a.jsxs)(Z.a,{className:"btn d-flex",variant:s?"primary":"outline-primary",size:"sm",onClick:function(){return i(t)},children:[n,Object(a.jsx)(B.a,{checked:s,onChange:function(){return i(t)}})]})}var D=function(e){var t=e.itemsList,n=e.selected,s=e.onChange,o=e.min,c=void 0===o?0:o,r=e.Checkbox,u=void 0===r?R:r;return Object(a.jsx)(i.Fragment,{children:t.map((function(e){var t=e.key,i=e.title;return Object(a.jsx)(u,{vkey:t,title:i,checked:-1!==n.indexOf(t),onChange:function(){return s(function(e,t,n){var a=e.indexOf(t);return-1===a?[].concat(Object(_.a)(e),[t]):e.length<=n?e:[].concat(Object(_.a)(e.slice(0,a)),Object(_.a)(e.slice(a+1)))}(n,t,c))}},t)}))})},J=n(61),q=n(50);function H(e){var t=e.vkey,n=e.title,i=e.onChange,s=e.checked;return Object(a.jsxs)(q.a.Item,{onMouseDown:function(e){return i(t)},onClick:function(e){return e.stopPropagation()},active:s,children:[n,Object(a.jsx)(B.a,{checked:s,onMouseDown:function(e){return i(t)},onChange:function(){}})]})}function K(e){var t=e.title,n=e.itemsList,s=e.selected,o=e.onChange,c=e.min,r=Object(i.useState)(!1),l=Object(u.a)(r,2),h=l[0],d=l[1];Object(i.useEffect)((function(){if(h)var e=document.addEventListener("click",(function(){d(!1),document.removeEventListener("click",e)}))}),[h]);return Object(a.jsx)(J.a,{title:t,show:h,onClick:function(e){d(!h),e.preventDefault(),e.stopPropagation()},variant:"outline-primary",children:Object(a.jsx)(D,{Checkbox:H,itemsList:n,selected:s,rootCloseEvent:"mousedown",onChange:o,min:c})})}var Q=n(13),V=n(62);function G(e){var t=e.title,n=e.onClick,i=e.loading,s=e.disabled,o=Object(Q.a)(e,["title","onClick","loading","disabled"]);return Object(a.jsxs)(Z.a,Object(l.a)(Object(l.a)({disabled:s||i,onClick:n},o),{},{children:[t,i?Object(a.jsx)(V.a,{as:"span",animation:"border",size:"sm",className:"spinner-border ml-2"}):null]}))}n(85);var W=n(63);var X=function(e){var t=e.filters,n=e.setFilter,i=e.tagsList,s=e.languages,o=e.languagesList,c=e.getItems,r=e.disabled,u=e.loading,l=e.updateItems,h=e.setLanguages;return Object(a.jsxs)(E.a,{className:"item-filters",children:[Object(a.jsx)(P.a,{children:Object(a.jsx)(E.a.Text,{children:"Categories"})}),Object(a.jsx)(P.a,{className:"form-row row-tags",children:Object(a.jsx)(D,{itemsList:i,selected:t.tags,onChange:function(e){return n({tags:e})},min:1})}),Object(a.jsxs)(P.a,{className:"d-flex align-items-center",children:[Object(a.jsxs)(W.a,{children:[Object(a.jsx)(E.a.Text,{className:"form-text text-left",children:"Limit"}),Object(a.jsx)(E.a.Control,{label:"Limit",as:"input",type:"number",value:t.limit,onChange:function(e){return n({limit:e.target.value})}}),Object(a.jsx)(E.a.Check,{type:"checkbox",className:"mr-auto text-left",checked:t.hideFilled,label:"Hide filled",onChange:function(e){return n({hideFilled:e.target.checked})}})]}),Object(a.jsx)(W.a,{children:Object(a.jsx)(K,{title:"Languages",itemsList:o,selected:s,onChange:h,min:1})})]}),Object(a.jsxs)(P.a,{className:"d-flex justify-content-end",children:[Object(a.jsx)(G,{title:"Get names",size:"lg",disabled:r.items,onClick:c,loading:u.items}),Object(a.jsx)(G,{title:"Update names",size:"lg",disabled:r.updates,onClick:l,loading:u.updates})]})]})},Y=n(64);function $(e){var t=e.languages,n=e.onClick,i=["Name"].concat(Object(_.a)(t.map((function(e){return"Name:".concat(e)}))));return Object(a.jsx)("tr",{children:i.map((function(e){return Object(a.jsx)("th",{style:{cursor:"pointer"},onClick:function(){return n(e.toLowerCase())},children:e},e)}))})}function ee(e){var t=e.item,n=e.languages,s=e.focused,o=e.handlers,c=o.onFocus,r=o.onBlur,u=o.onChange,l=o.onIconClick,h=Object(i.useRef)(null);return Object(i.useEffect)((function(){s&&h.current.focus()}),[s]),Object(a.jsxs)("tr",{children:[Object(a.jsxs)("td",{children:[Object(a.jsx)("i",{className:"fa fa-crosshairs icon-btn mt-1",style:{float:"left"},onClick:function(){return l(t)}}),Object(a.jsx)("span",{children:t.tags.name})]}),n.map((function(e,n){return Object(a.jsx)("td",{children:Object(a.jsx)("input",{type:"text",ref:n?null:h,value:t.tags["name:".concat(e)]||"",onChange:function(n){return u(t,e,n.target.value)},onFocus:function(){return s?null:c(t.id)},onBlur:function(){return s?r(t.id):null}})},e)}))]},t.id)}n(86);var te=function(e){var t=e.languages,n=e.handlers,s=e.items,o=e.focused,c=Object(i.useState)("name"),r=Object(u.a)(c,2),l=r[0],h=r[1],d=Object(i.useState)(1),g=Object(u.a)(d,2),m=g[0],f=g[1];return Object(a.jsx)(i.Fragment,{children:Object(a.jsxs)(Y.a,{size:"sm",children:[Object(a.jsx)("thead",{children:Object(a.jsx)($,{languages:t,onClick:function(e){e===l?f(-m):h(e)}})}),Object(a.jsx)("tbody",{children:s.filter((function(e){return e.tags.name})).sort((function(e,t){return m*function(e,t,n){return(e.tags[n]||"").localeCompare(t.tags[n]||"")}(e,t,l)})).map((function(e){return Object(a.jsx)(ee,{languages:t,item:e,focused:o===e.id,handlers:n},e.id)}))})]})})},ne=n(36),ae=(n(87),n(65));function ie(e){var t=e.user,n=e.logout;return Object(a.jsxs)(i.Fragment,{children:[t.img?Object(a.jsx)(ae.a,{src:t.img.href,className:"avatar",thumbnail:!0,rounded:!0}):null,Object(a.jsx)(ne.a.Text,{className:"mx-2",children:t.display_name}),Object(a.jsx)(Z.a,{onClick:n,children:"Logout"})]})}function se(e){var t=e.login,n=e.loading;return Object(a.jsx)(G,{title:"login",loading:n,onClick:t})}var oe=n.p+"static/media/logo.6ce24c58.svg";var ce=function(e){var t=e.user,n=e.login,i=e.logout,s=e.loading;return Object(a.jsxs)(ne.a,{variant:"light",bg:"white",children:[Object(a.jsxs)(ne.a.Brand,{className:"mr-auto",children:[Object(a.jsx)("img",{src:oe,alt:"App logo",className:"mx-1 avatar"}),"OpenStreetMap Localization Tool"]}),t.loggedIn?Object(a.jsx)(ie,{logout:i,user:t}):Object(a.jsx)(se,{login:n,loading:s})]})},re=n(66),ue=n.n(re),le="https://overpass-api.de/api/interpreter",he=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(h.a)(this,e),this.apiUrl=t.apiUrl||le}return Object(d.a)(e,[{key:"query",value:function(e){var t=this,n=e.bbox,a=e.zoom,i=e.center,s=e.filters,o=e.languages,c=s.tags.map((function(e){return'nwr["'.concat(e,'"]["name"]')})),r=a>1?"(".concat(n.join(","),")"):"(around:".concat(75e3,",").concat(i.join(","),")"),u=(s.hideFilled?c.map((function(e){return o.map((function(t){return"".concat(e,'[!"name:').concat(t,'"]').concat(r)})).join(";\n")})):c.map((function(e){return e+r}))).join(";\n"),l=s.limit?" "+s.limit:"",h="[out:json][timeout:25];\n            (\n                ".concat(u,";\n            );\n            out ").concat("qt body meta center"," ").concat(l,";"),d=new FormData;d.append("data",h);var g=performance.now();return this.reqId=g,new Promise((function(e,n){fetch(t.apiUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"},body:new URLSearchParams(d)}).then((function(a){return a.ok?a.json().then((function(a){var i=a.elements,s=a.remark;t.reqId!==g?n():(s&&-1!==s.indexOf("error")&&n(s),e(i))})):a.text().then(n)})).catch((function(e){return n(e)}))}))}}]),e}(),de="OSM-Localization-Web";function ge(e){return Object.entries(e).map((function(e){var t=Object(u.a)(e,2),n=t[0],a=t[1],i=[],s="";Object.entries(a).forEach((function(e){var t=Object(u.a)(e,2),n=t[0],a=t[1];if(Array.isArray(a)){var o=n.replace(/s$/,"");s+=a.map((function(e){return ge(Object(r.a)({},o,e))})).join("")}else"object"===typeof a?s+=ge(Object(r.a)({},n,a)):i.push([n,a])}));var o=i.map((function(e){var t=Object(u.a)(e,2),n=t[0],a=t[1];return"".concat(n,'="').concat(a,'"')})).join(" ");return s?"<".concat(n," ").concat(o,">").concat(s,"</").concat(n,">"):"<".concat(n," ").concat(o,"/>")})).join("")}function me(e,t){return ge({osmChange:{version:"0.6",generator:de,modify:Object.values(e).map((function(e){var n=e.type,a=e.tags,i=e.nodes,s=e.members,o=Object(Q.a)(e,["type","tags","nodes","members"]);return Object(r.a)({},n,Object(l.a)(Object(l.a)(Object(l.a)({},o),{},{changeset:t,tags:Object.entries(a).map((function(e){var t=Object(u.a)(e,2);return{k:t[0],v:t[1]}}))},i?{nd:i.map((function(e){return{ref:e}}))}:{}),s?{members:s}:{}))}))}})}var fe=function(){function e(t){Object(h.a)(this,e),this.config=t,this.auth=ue()(Object(l.a)({},t)),this.overpass=new he({apiUrl:t.overpassApiUrl}),this.apiRoute="/api/0.6",this.currentChangeset=t.changeset||!1}return Object(d.a)(e,[{key:"fetch",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.method,i=n.body,s=n.headers,o=void 0===s?{}:s,c=Object(Q.a)(n,["method","body","headers"]);return new Promise((function(n,s){return t.auth.xhr({method:a||"GET",path:t.apiRoute+e,content:i,options:Object(l.a)({header:o},c)},(function(e,t){e?s(e):n(t)}))}))}},{key:"fetchJson",value:function(e,t){return this.fetch(e,t).then((function(e){return JSON.parse(e)}))}},{key:"authenticated",value:function(){return this.auth.authenticated()}},{key:"login",value:function(){var e=this;return new Promise((function(t){return e.auth.authenticate((function(e){t(e)}))}))}},{key:"logout",value:function(){this.auth.logout()}},{key:"getUser",value:function(){return this.fetchJson("/user/details.json")}},{key:"getElements",value:function(e){return this.overpass.query(e)}},{key:"updateElements",value:function(e){var t=this;return this.currentChangeset?this.checkChangesetOpen().then((function(n){return n?t.updateChangeset(e):t.createChangeset().then((function(){return t.updateChangeset(e)}))})):this.createChangeset().then((function(){return t.updateChangeset(e)}))}},{key:"getChangesets",value:function(){return this.fetch("/changesets")}},{key:"createChangeset",value:function(){var e=this;return this.fetch("/changeset/create",{method:"PUT",body:ge({osm:{changeset:[{tag:{k:"created_by",v:de}},{tag:{k:"comment",v:"Adding localized names"}}]}}),headers:{"Content-Type":"text/plain"}}).then((function(t){e.currentChangeset=t}))}},{key:"checkChangesetOpen",value:function(){return this.fetchJson("/changeset/".concat(this.currentChangeset,".json")).then((function(e){var t;return null===(t=e.elements)||void 0===t?void 0:t.pop().open}))}},{key:"updateChangeset",value:function(e){return this.fetch("/changeset/".concat(this.currentChangeset,"/upload"),{method:"POST",body:me(e,this.currentChangeset),headers:{"Content-Type":"text/plain"}}).then((function(e){return Object.fromEntries(Array.from(e.children[0].children).map((function(e){return[e.getAttribute("new_id"),{version:+e.getAttribute("new_version")}]})))}))}},{key:"closeChangeset",value:function(){return this.fetch("/changeset/".concat(this.currentChangeset,"/close"),{method:"PUT",headers:{"Content-Type":"text/plain"}})}}]),e}(),be=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:31536e3;Object(h.a)(this,e),this.cookieDuration=t}return Object(d.a)(e,[{key:"get",value:function(e){var t=document.cookie.split(";").find((function(t){return-1!==t.indexOf(e+"=")}));return!!t&&t.replace(e+"=","").trim()}},{key:"write",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.cookieDuration,n=new Date(Date.now()+1e3*t).toUTCString();Object.entries(e).forEach((function(e){var t=Object(u.a)(e,2),a=t[0],i=t[1];document.cookie="".concat(a,"=").concat(i,"; path=/; expires=").concat(n)}))}},{key:"clear",value:function(){document.cookie.split(";").forEach((function(e){var t=e.split("=")[0];document.cookie="".concat(t,"=; path=/")}))}}]),e}(),je=function(e,t){return t.find((function(t){return!e.tags["name:".concat(t)]}))},pe=function(){function e(){Object(h.a)(this,e),this.updates={},this.storageKey="osm-localizer_updated-items"}return Object(d.a)(e,[{key:"load",value:function(){if(window.localStorage){var e=localStorage.getItem(this.storageKey);e&&(this.updates=JSON.parse(e))}}},{key:"store",value:function(){window.localStorage&&localStorage.setItem(this.storageKey,JSON.stringify(this.updates))}},{key:"patchAndStore",value:function(e,t){for(var n in t)e[n]&&(e[n]=Object(l.a)(Object(l.a)({},e[n]),t[n]),this.updates[n]=e[n]);this.store()}},{key:"sync",value:function(e,t,n){for(var a=[],i=0,s=e.length;i<s;i++){var o=e[i].id;this.updates[o]?this.updates[o].version>e[i].version?t&&!je(this.updates[o],n)||a.push(this.updates[o]):(delete this.updates[o],a.push(e[i])):a.push(e[i])}return this.store(),a}}]),e}(),ve=(n(102),n(103),Object(l.a)(Object(l.a)({},{oauth_consumer_key:"p2szywibtwHNFh1RZVNq21uCo9XBuUZvEwz0sYae",oauth_secret:"e2oP3FSVjFLEq3zgQylpYMVVX7QJUKcchJLh4Ksm",url:"https://www.openstreetmap.org"}),{},{overpassApiUrl:"https://overpass.kumi.systems/api/interpreter"})),Oe=[{key:"de",title:"Deutsch"},{key:"en",title:"English"},{key:"fr",title:"Fran\xe7ais"},{key:"ja",title:"\u65e5\u672c\u8a9e"},{key:"ru",title:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439"},{key:"zh",title:"\u4e2d\u6587"}],ye=[{key:"aerialway",title:"Aerialway"},{key:"aerolway",title:"Aeroway"},{key:"amenity",title:"Amenity"},{key:"barrier",title:"Barrier"},{key:"boundary",title:"Boundary"},{key:"building",title:"Building"},{key:"craft",title:"Craft"},{key:"emergency",title:"Emergency"},{key:"geological",title:"Geological"},{key:"healthcare",title:"Healthcare"},{key:"highway",title:"Highway"},{key:"historic",title:"Historic"},{key:"landuse",title:"Landuse"},{key:"leisure",title:"Leisure"},{key:"man_made",title:"Man-made"},{key:"military",title:"Military"},{key:"natural",title:"Natural"},{key:"office",title:"Office"},{key:"place",title:"Place"},{key:"power",title:"Power"},{key:"public_transport",title:"Public transport"},{key:"railway",title:"Railway"},{key:"route",title:"Route"},{key:"shop",title:"Shop"},{key:"telecom",title:"Telecom"},{key:"tourism",title:"Tourism"},{key:"waterway",title:"Waterway"}],ke=n(52),xe="_osm-localization_languages",Ce="_osm-locatization_changeset",we=function(e){return e.center?[e.center.lat,e.center.lon]:[e.lat,e.lon]},Se=function(e){Object(g.a)(n,e);var t=Object(m.a)(n);function n(e){var a;Object(h.a)(this,n),(a=t.call(this,e)).cookieManager=new be,a.osmApi=new fe(Object(l.a)(Object(l.a)({},ve),{},{changeset:a.cookieManager.get(Ce)})),a.updatesStorage=new pe,a.updatesStorage.load();var i=a.parseURLPath(),s=i.zoom,o=i.center,c=a.parseURLQuery();return a.bbox=[],a.state={user:{loggedIn:!1},center:o,zoom:s,filters:c,items:[],itemsToUpdate:{},focusedItem:!1,watchFocus:!1,loading:{items:!1,updates:!1,auth:!1},serverMsg:{error:!1,text:""}},a}return Object(d.a)(n,[{key:"parseURLPath",value:function(){var e=6,t=[0,0],n=ke.a.location.hash.replace("#/","");if(n){var a=n.split("/"),i=Object(u.a)(a,3);e=+i[0],t=[+i[1],+i[2]]}return{zoom:e,center:t}}},{key:"parseURLQuery",value:function(){var e={tags:["place"],limit:100,hideFilled:!1},t=ke.a.location.search.replace("?","");if(t){var n=Object.fromEntries(t.split("&").map((function(e){return e.split("=")})));if(n.tags){var a=n.tags.split(",").filter((function(e){return ye.find((function(t){return t.key===e}))}));a.length&&(e.tags=a)}if(n.limit){var i=parseInt(n.limit);isNaN(i)||(e.limit=i)}n.hide_filled&&(e.hideFilled=n.hide_filled&&0!==+n.hide_filled)}return e}},{key:"updateLocation",value:function(){var e=this.state,t=e.zoom,n=Object(u.a)(e.center,2),a=n[0],i=n[1],s=e.filters,o=s.tags,c=s.limit,r=s.hideFilled,l=["/#",t,a.toFixed(4),i.toFixed(4)].join("/"),h=["tags=".concat(o.join(","))];c&&h.push("limit=".concat(c)),r&&h.push("hide_filled=1");var d="?"+h.join("&");ke.a.push({search:d,hash:l})}},{key:"componentDidMount",value:function(){this.osmApi.authenticated()&&this.getUser()}},{key:"setServerMsg",value:function(e){var t=this;this.setState({serverMsg:e});document.addEventListener("click",(function e(){document.removeEventListener("click",e),t.setState({serverMsg:{error:!1,text:""}})}))}},{key:"login",value:function(){var e=this;this.setState({loading:Object(l.a)(Object(l.a)({},this.state.loading),{},{auth:!0})}),this.osmApi.login().then((function(){e.getUser()}))}},{key:"getLanguages",value:function(){var e=this.cookieManager.get(xe);return!!e&&e.split("+")}},{key:"setLanguages",value:function(e){this.setState({user:Object(l.a)(Object(l.a)({},this.state.user),{},{languages:e})}),this.storeLanguages(e)}},{key:"storeLanguages",value:function(e){this.cookieManager.write(Object(r.a)({},xe,e.join("+")))}},{key:"getUser",value:function(){var e=this;this.osmApi.getUser().then((function(t){var n=e.getLanguages()||t.user.languages.filter((function(e){return Oe.find((function(t){return t.key===e}))}));e.setState({loading:Object(l.a)(Object(l.a)({},e.state.loading),{},{auth:!1}),user:Object(l.a)(Object(l.a)({loggedIn:!0},t.user),{},{languages:n})}),e.storeLanguages(n)}))}},{key:"logout",value:function(){this.osmApi.logout(),this.setState({user:{loggedIn:!1}})}},{key:"getItems",value:function(){var e=this;this.setState({loading:Object(l.a)(Object(l.a)({},this.state.loading),{},{items:!0})}),this.osmApi.getElements({center:this.state.center,zoom:this.state.zoom,bbox:this.bbox,filters:this.state.filters,languages:this.state.user.languages}).then((function(t){e.setState({items:e.updatesStorage.sync(t,e.state.filters.hideFilled,e.state.user.languages),itemsToUpdate:{},loading:Object(l.a)(Object(l.a)({},e.state.loading),{},{items:!1})})})).catch((function(t){console.log(t),e.setState({loading:Object(l.a)(Object(l.a)({},e.state.loading),{},{items:!1})}),e.setServerMsg({text:t,error:!0})}))}},{key:"updatePosition",value:function(e){var t=this,n=e.bbox,a=e.center,i=e.zoom;this.setState({center:a,zoom:i},(function(){return t.updateLocation()})),this.bbox=n}},{key:"updateBbox",value:function(e){var t=e.bbox;this.bbox=t}},{key:"updateItem",value:function(e,t,n){e.tags["name:".concat(t)]=n,this.setState({itemsToUpdate:Object(l.a)(Object(l.a)({},this.state.itemsToUpdate),{},Object(r.a)({},e.id,e))})}},{key:"setFilter",value:function(e){var t=this;this.setState({filters:Object(l.a)(Object(l.a)({},this.state.filters),e)},(function(){return t.updateLocation()}))}},{key:"updateItems",value:function(){var e=this;this.setState({loading:Object(l.a)(Object(l.a)({},this.state.loading),{},{updates:!0})}),this.osmApi.updateElements(this.state.itemsToUpdate).then((function(t){e.updatesStorage.patchAndStore(e.state.itemsToUpdate,t),e.cookieManager.write(Object(r.a)({},Ce,e.osmApi.currentChangeset)),e.setServerMsg({text:"Items are successfully updated.",error:!1}),e.setState({itemsToUpdate:{},loading:Object(l.a)(Object(l.a)({},e.state.loading),{},{updates:!1})})})).catch((function(t){e.setServerMsg({text:String.toString(t),error:!0}),e.setState({loading:Object(l.a)(Object(l.a)({},e.state.loading),{},{updates:!1})})}))}},{key:"focusItem",value:function(e){if(this.state.watchFocus){var t=this.state.items.find((function(t){return t.id===e}));this.setState({center:we(t),focusedItem:e})}else this.setState({focusedItem:e})}},{key:"blurItem",value:function(){this.setState({focusedItem:!1})}},{key:"centerItem",value:function(e){this.setState({center:we(e),zoom:Math.max(this.state.zoom,14)})}},{key:"render",value:function(){var e={items:this.state.zoom<10||this.state.loading.updates,updates:!Object.keys(this.state.itemsToUpdate).length},t=Object.keys(this.state.itemsToUpdate).map((function(e){return+e})),n={onLoad:this.updateBbox.bind(this),onMove:this.updatePosition.bind(this),onClickItem:this.focusItem.bind(this),onClickMap:this.blurItem.bind(this)},s={onFocus:this.focusItem.bind(this),onBlur:this.blurItem.bind(this),onChange:this.updateItem.bind(this),onIconClick:this.centerItem.bind(this)},o=this.state.user.languages?this.state.user.languages[0]:"en";return Object(a.jsxs)(f.a,{className:"App",fluid:!0,children:[Object(a.jsx)(ce,{login:this.login.bind(this),logout:this.logout.bind(this),user:this.state.user,loading:this.state.loading.auth}),Object(a.jsx)(N,{zoom:this.state.zoom,center:this.state.center,items:this.state.items,lang:o,touched:t,focused:this.state.focusedItem,watchFocus:this.state.watchFocus,handlers:n}),Object(a.jsx)(b.a,{className:"card-items card p-1",children:this.state.user.loggedIn?Object(a.jsxs)(i.Fragment,{children:[Object(a.jsxs)(b.a.Header,{children:[Object(a.jsx)(X,{filters:this.state.filters,setFilter:this.setFilter.bind(this),tagsList:ye,loading:this.state.loading,languages:this.state.user.languages||[],languagesList:Oe,setLanguages:this.setLanguages.bind(this),items:this.state.items,getItems:this.getItems.bind(this),disabled:e,updateItems:this.updateItems.bind(this)}),Object(a.jsx)("div",{className:this.state.serverMsg.error?"text-danger":"text-success",children:this.state.serverMsg.text})]}),Object(a.jsx)(b.a.Body,{className:this.state.loading.items?"items-loading":"",children:Object(a.jsx)(te,{languages:this.state.user.languages||[],items:this.state.items,focused:this.state.focusedItem,handlers:s})})]}):Object(a.jsx)(b.a.Body,{className:"d-flex align-items-center justify-content-center",children:Object(a.jsx)(A,{})})})]})}}]),n}(i.Component),Le=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,115)).then((function(t){var n=t.getCLS,a=t.getFID,i=t.getFCP,s=t.getLCP,o=t.getTTFB;n(e),a(e),i(e),s(e),o(e)}))};c.a.render(Object(a.jsx)(s.a.StrictMode,{children:Object(a.jsx)(Se,{})}),document.getElementById("root")),Le()},76:function(e,t,n){},85:function(e,t,n){},86:function(e,t,n){},87:function(e,t,n){}},[[104,1,2]]]);
//# sourceMappingURL=main.500a2879.chunk.js.map